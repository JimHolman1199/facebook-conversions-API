___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "type": "TAG",
  "id": "cvt_temp_public_id",
  "version": 1,
  "securityGroups": [],
  "displayName": "FB conversion API",
  "brand": {
    "id": "brand_dummy",
    "displayName": "",
    "thumbnail": "data:image/png;base64,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"
  },
  "description": "Send conversions to Facebook using Conversions API from the GTM web client",
  "containerContexts": [
    "WEB"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "TEXT",
    "name": "pixel_id",
    "displayName": "Facebook Pixel ID",
    "simpleValueType": true,
    "valueHint": "e.g. 12345678910",
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      },
      {
        "type": "REGEX",
        "args": [
          "^[0-9,]+$"
        ]
      }
    ],
    "defaultValue": "{{Facebook - Pixel ID}}"
  },
  {
    "type": "TEXT",
    "name": "client",
    "displayName": "Predefined client name",
    "simpleValueType": true,
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      }
    ],
    "defaultValue": "{{FB - conversion api - token key}}"
  },
  {
    "type": "LABEL",
    "name": "event_name",
    "displayName": "Event Name"
  },
  {
    "type": "TEXT",
    "name": "eventName",
    "displayName": "",
    "simpleValueType": true,
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      }
    ]
  },
  {
    "type": "LABEL",
    "name": "event_id",
    "displayName": "Event ID"
  },
  {
    "type": "TEXT",
    "name": "eventID",
    "simpleValueType": true,
    "displayName": "",
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      }
    ],
    "defaultValue": "{{Unique Event ID}}"
  },
  {
    "type": "GROUP",
    "name": "userData",
    "displayName": "User data",
    "groupStyle": "ZIPPY_CLOSED",
    "subParams": [
      {
        "type": "SIMPLE_TABLE",
        "name": "userDataObj",
        "displayName": "",
        "simpleTableColumns": [
          {
            "defaultValue": "",
            "displayName": "User data",
            "name": "name",
            "type": "SELECT",
            "selectItems": [
              {
                "value": "email",
                "displayValue": "Email"
              },
              {
                "value": "phone",
                "displayValue": "Phone"
              },
              {
                "value": "firstName",
                "displayValue": "First name"
              },
              {
                "value": "lastName",
                "displayValue": "Last name"
              }
            ],
            "valueValidators": []
          },
          {
            "defaultValue": "",
            "displayName": "Value",
            "name": "value",
            "type": "TEXT"
          }
        ],
        "valueValidators": []
      }
    ]
  },
  {
    "type": "GROUP",
    "name": "customData",
    "displayName": "Custom data",
    "groupStyle": "ZIPPY_CLOSED",
    "subParams": [
      {
        "type": "SIMPLE_TABLE",
        "name": "customDataObj",
        "displayName": "",
        "simpleTableColumns": [
          {
            "defaultValue": "",
            "displayName": "Custom data",
            "name": "name",
            "type": "SELECT",
            "selectItems": [
              {
                "value": "order_id",
                "displayValue": "Order ID"
              },
              {
                "value": "value",
                "displayValue": "Value"
              },
              {
                "value": "currency",
                "displayValue": "Currency"
              },
              {
                "value": "productsArr",
                "displayValue": "Product Array"
              }
            ]
          },
          {
            "defaultValue": "",
            "displayName": "Value",
            "name": "value",
            "type": "TEXT"
          }
        ]
      }
    ]
  },
  {
    "type": "GROUP",
    "name": "customProp",
    "displayName": "Custom Properties",
    "groupStyle": "ZIPPY_CLOSED",
    "subParams": [
      {
        "type": "SIMPLE_TABLE",
        "name": "customPropObj",
        "simpleTableColumns": [
          {
            "defaultValue": "",
            "displayName": "Property Name",
            "name": "name",
            "type": "TEXT"
          },
          {
            "defaultValue": "",
            "displayName": "Property Value",
            "name": "value",
            "type": "TEXT"
          }
        ],
        "newRowButtonText": "Add property"
      },
      {
        "type": "SELECT",
        "name": "objectPropertiesFromVariable",
        "displayName": "Load Properties From Variable",
        "macrosInSelect": true,
        "selectItems": [
          {
            "value": false,
            "displayValue": "False"
          }
        ],
        "simpleValueType": true,
        "help": "You can use a variable that returns a JavaScript object with the properties you want to use. This object will be merged with any additional properties you add via the table below. Any conflicts will be resolved in favor of the properties you add to the table."
      }
    ]
  }
]


___SANDBOXED_JS_FOR_WEB_TEMPLATE___

// Enter your template code here.
const log = require('logToConsole');
const getCookieValues = require('getCookieValues');
const callInWindow = require('callInWindow');
const getUrl = require('getUrl');
const injectScript = require('injectScript');
const queryPermission = require('queryPermission');

log('data =', data);
const postScriptUrl = 'https://afternoon-journey-05311.herokuapp.com/api/cdn/request.js';
const URL = 'https://afternoon-journey-05311.herokuapp.com/api/facebook/event';

const modifyData = (arr) => {
  return arr.map(el => {
    const obj = {};
    obj[el.name] = el.value;
    return obj;
  });
};

const mergeObj = (arr) => {
  if(!arr) {
    return {};
  }
  const arrObj = modifyData(arr);
  return arrObj.reduce(function(acc, x) {
    for (var key in x) acc[key] = x[key];
    return acc;
  }, {});
};

const mergeTwoObj = (obj, obj2) => {
  obj = obj || {};
  obj2 = obj2 || {};
  for (let key in obj2) {
    if (obj2.hasOwnProperty(key)) {
      obj[key] = obj2[key];
    }
  }
  return obj;
};


const payload = {
  client: data.client,
  pixel_id: data.pixel_id,
  user: mergeTwoObj(
    mergeObj(data.userDataObj),
  {
      eventName: data.eventName,
      fbp: getCookieValues('_fbp')[0],
      fbc: getCookieValues('_fbc')[0],
      sourceUrl: getUrl()
   }),
   customData: mergeTwoObj(mergeObj(data.customDataObj), {
       event_id: data.eventID,
       customProp: mergeObj(data.customPropObj)
   })
};

const onSuccess = () => {
  if (queryPermission('access_globals', 'execute','sendRequest')){
    const response = callInWindow('sendRequest', 'POST', URL, payload);
    log('response', response);
    data.gtmOnSuccess();
  } else{
    data.gtmOnFailure();
  }
};

const onFailure = () => {
  log('Conductrics: Script load failed.');
  data.gtmOnFailure();
};

if (queryPermission('inject_script', postScriptUrl)) {
  injectScript(postScriptUrl, onSuccess, onFailure, postScriptUrl);
} else {
  log('Conductrics: Script load failed due to permissions mismatch.');
  data.gtmOnFailure();
}


___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "debug"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "access_globals",
        "versionId": "1"
      },
      "param": [
        {
          "key": "keys",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "sendData"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "sendRequest"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "get_cookies",
        "versionId": "1"
      },
      "param": [
        {
          "key": "cookieAccess",
          "value": {
            "type": 1,
            "string": "any"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "get_url",
        "versionId": "1"
      },
      "param": [
        {
          "key": "urlParts",
          "value": {
            "type": 1,
            "string": "any"
          }
        },
        {
          "key": "queriesAllowed",
          "value": {
            "type": 1,
            "string": "any"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "inject_script",
        "versionId": "1"
      },
      "param": [
        {
          "key": "urls",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "https://afternoon-journey-05311.herokuapp.com/*"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios: []


___NOTES___

Created on 12/21/2021, 9:46:19 AM


